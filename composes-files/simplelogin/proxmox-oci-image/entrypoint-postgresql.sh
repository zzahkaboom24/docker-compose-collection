/bin/sh -c "> /var/log/lxc/lxc.log && (while true; do clear && printf '\e[3J'; tail -n 100 /var/log/lxc/lxc.log > /var/log/lxc/lxc.log.tmp && cat /var/log/lxc/lxc.log.tmp > /var/log/lxc/lxc.log && rm /var/log/lxc/lxc.log.tmp || true; cat /var/log/lxc/lxc.log; sleep 2; done) > /dev/console 2>&1 & docker-entrypoint.sh postgres >> /var/log/lxc/lxc.log 2>&1 & until pg_isready -U simplelogin -p 5432 >/dev/null 2>&1; do sleep 5; done && printf '%s' 'DO $outer$ BEGIN IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = '\''public_domain'\'') THEN DROP TRIGGER IF EXISTS clear_public_domain_trigger ON public_domain; CREATE OR REPLACE FUNCTION clear_public_domain() RETURNS TRIGGER AS $func$ BEGIN DELETE FROM public_domain; RETURN NULL; END; $func$ LANGUAGE plpgsql; CREATE TRIGGER clear_public_domain_trigger AFTER INSERT ON public_domain FOR EACH STATEMENT EXECUTE FUNCTION clear_public_domain(); DELETE FROM public_domain; END IF; END $outer$;' | psql -U simplelogin -d simplelogin -p 5432 >> /var/log/lxc/lxc.log 2>&1 & wait"
